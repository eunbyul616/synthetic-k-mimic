import os
import numpy as np
import pandas as pd
from typing import List

from Visualization.timeseries import timeseries_trajectory


def visualize_patient_trajectory(real_data: pd.DataFrame,
                                 synthetic_data: pd.DataFrame,
                                 time_col: str,
                                 label: List[str] = ['Real', 'Synthetic'],
                                 color: List[str] = ['royalblue', 'crimson'],
                                 save_path: str=None) -> None:
    """
    Visualize patient trajectories for each feature in the given datasets.

    Args:
        real_data: real data. Each column represents a feature, and rows represent time points.
        synthetic_data: synthetic data generated by the model. Should have the same structure as 'real_data'
        time_col: name of the column representing time or sequential index in the data.
        label: label for real and synthetic data
        color: list of colors for each data. Default is ['royalblue', 'crimson']
        save_path: save the plot to the given path. If None, the plot will be displayed

    Returns:
        None
    """
    for col in real_data.columns:
        if save_path is not None:
            fpath = os.path.join(save_path, f'patient_trajectory_{col}.png')
        else:
            fpath = None

        timeseries_trajectory(data=[real_data, synthetic_data],
                              x_col=time_col,
                              y_col=col,
                              label=label,
                              color=color,
                              title=f'Patient Trajectory: {col}',
                              save_path=fpath)


if __name__ == "__main__":
    import config_manager
    config_manager.load_config()
    cfg = config_manager.config

    save_path = cfg.path.plot_path

    real_data = pd.DataFrame({'A': np.random.normal(0, 1, 1000),
                              'B': np.random.normal(0, 1, 1000),
                              'C': np.random.choice(['X', 'Y', 'Z'], 1000),
                              'D': np.random.choice([0, 1], 1000),
                              'E': np.random.choice([0, 1], 1000),
                              'time': np.arange(1000)})

    synthetic_data = pd.DataFrame({'A': np.random.normal(0, 1, 1000),
                                   'B': np.random.normal(0, 1, 1000),
                                   'C': np.random.choice(['X', 'Y', 'Z'], 1000),
                                   'D': np.random.choice([0, 1], 1000),
                                   'E': np.random.choice([0, 1], 1000),
                                   'time': np.arange(1000)
                                   })

    visualize_patient_trajectory(real_data=real_data,
                                 synthetic_data=synthetic_data,
                                 time_col='time',
                                 label=['Real', 'Synthetic'],
                                 save_path=save_path)